<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="main.css">
        <title>Bitcoin: Verification of Transactions</title>
    </head>

    <body>
        <div class="header">
            <table class="header">
                <td class="space"></td>
                <td>
                    <table>

                        <tr>

                            <td class="navbar">
                            
                                <div class="dropdown-menu">
                                    <button class="dropdown"><a href="introduction.html">Introduction</a></button>
                                    <div class="dropdown-elems">

                                        <a class="dropdown" href="introduction.html#Lorem">Lorem</a>
                                        <a class="dropdown" href="introduction.html#Quaeque">Quaeque</a>
                                        <a class="dropdown" href="introduction.html#No">No</a>

                                    </div>
                                </div>
                                
                            </td>
                            <td class="navbar">
                            
                                <div class="dropdown-menu">
                                    <button class="dropdown"><a href="transactions.html">Transactions</a></button>
                                    <div class="dropdown-elems"></div>
                                </div>
                                
                            </td>
                            <td class="navbar">
                            
                                <div class="dropdown-menu">
                                    <button class="dropdown"><a href="verification.html"><strong>Verification</strong></a></button>
                                    <div class="dropdown-elems">
                                    
                                        <a class="dropdown" href="verification.html#Overview">Overview</a>
                                        <a class="dropdown" href="verification.html#Encryption_Basics">Asymmetric Encryption</a>
                                        <a class="dropdown" href="verification.html#P2PKH">P2PKH</a>
                                        <a class="dropdown" href="verification.html#P2SH">P2SH</a>
                                        <a class="dropdown" href="verification.html#Multisig">Multisig</a>
                                        <a class="dropdown" href="verification.html#Pubkey">Pubkey</a>
                                           
                                    </div>
                                </div>
                                
                            </td>
                            <td class="navbar">
                            
                                <div class="dropdown-menu">
                                    <button class="dropdown"><a href="usability.html">Usability</a></button>
                                    <div class="dropdown-elems">
                                        
                                        <a class="dropdown" href="usability.html#Current_Situation">Current Situation</a>
                                        <a class="dropdown" href="usability.html#Evolution">Evolution of Bitcoin</a>
                                        <a class="dropdown" href="usability.html#Milestones">Milestones</a>
                                        
                                    </div>
                                </div>
                                
                            </td>
                            <td class="navbar">
                            
                                <div class="dropdown-menu">
                                    <button class="dropdown"><a href="overview.html">Overview</a></button>
                                    <div class="dropdown-elems"></div>
                                </div>
                                
                            </td>
                            <td class="navbar">
                            
                                <div class="dropdown-menu">
                                    <button class="dropdown"><a href="bibliography.html">Bibliography</a></button>
                                    <div class="dropdown-elems"></div>
                                </div>
                                
                            </td>

                        </tr>

                    </table>
                </td>
            </table>
            
        </div>
        
        <div class="main">
    
            <h1>Verification System</h1>
            
            <h2><a name="Overview">Overview</a></h2>
            
            <p>
                Before an output can be used as an input to another transaction, the spender must verify that they are the owner of the output. Each transaction contains a script which follows certain steps to check that the spender of the output is the rightful owner, and different types of scripts can follow different steps.
            </p>
            
            <h2><a name="Encryption_Basics">Basics of Asymmetric Encryption</a></h2>
            
            <p>
                If two parties want to exchange data without it being visible to any third party, one way to do it is asymmetric encryption. Bitcoin’s verification system relies heavily on this kind of encryption, so a brief explanation will be provided here. 
            </p>
            
            <p>
                In any system using asymmetric encryption, every user owns 2 separate keys: a public key, and a private key. A user’s public key is visible to any other user, but their private key is only visible to themselves. Anything encrypted using the private key (i.e. “locked”) can be decrypted (“unlocked”) using their public key, and vice-versa.
            </p>
            
            <table>
            
                <tr>
                    
                    <td>
                        
                        <p>
                            If a user wants to send data (e.g. Sally) to a recipient (e.g. Robert), they can use the following steps. First, Sally encrypts the data using Robert’s public key. This means that no-one can read the data without decrypting it. Sally can then send the encrypted (i.e. hashed) data to Robert. Robert can use his private key to decrypt the data. This means that only Robert can decrypt it, as only Robert has access to the private key corresponding to his public key.
                        </p>
                    </td>
                    
                    <td>
                        <img src="Asymmetric%20Encryption%20Diagram.png" style="height: 20vh; width: 25vw">
                    </td>
                
                </tr>
            
            </table>
            
            <h2><a name="P2PKH">Types of Scripts: P2PKH</a></h2>
            
            <p>
                P2PKH (Pay-To-Public-Key-Hash) scripts are the default script used for verifying bitcoin transactions. The steps for a P2PKH transaction are as follows:
            </p>
            
            <p>
                First, the recipient of the transaction (Robert) generates a private key, and stores it. This is used to create a public key, and this public key is hashed (referred to as the pubkey hash). These steps are reproducible, so Robert doesn’t need to store the public key or pubkey hash.
            </p>
            
            <p>
                Next, Robert gives a copy of the pubkey hash to the spender (Sally). Sally includes this in any outputs being given to Robert. The outputs will also contain a default pubkey script, which can verify the owner of the output when it is being spent.
            </p>
            
            <p>
                With this, the initial transaction can continue as normal. The pubkey script is not used for verification until the output is actually spent. The transaction will be broadcast and added to the block chain (assuming it is valid).
            </p>
            
            <p>
                In the transaction which spends the P2PKH output, Robert must verify that he owns the output. The pubkey script will return true or false, if false is returned then the second transaction will be invalidated. Robert must provide a signature and his public key to the pubkey script. The pubkey script executes the following steps:
            </p>
            
            <ul>
                
                <li>Robert’s signature is pushed to the execution stack</li>
                <li>Robert’s public key is pushed to the execution stack</li>
                <li>The public key is copied and pushed again to the stack</li>
                <li>The copy of the public key is hashed</li>
                <li>The original pubkey hash that Robert gave to Sally is then pushed to the stack</li>
                <li>The new pubkey hash is compared to the original. If they are different, the script returns false and evaluation halts</li>
                <li>Assuming they match, the signature is checked (decrypted with the now authenticated public key) – if it decrypts correctly and contains the necessary data, the transaction is valid</li>

            </ul>
            
            <table>
                
                <tr>
                    
                    <td valign="top">
                        
                        <p>
                            After this process (i.e. after the pubkey script is executed), if true is returned then the output is used in the second transaction as an input successfully (assuming that the rest of the transaction is valid).
                        </p>
                        
                    </td>
                    
                    <td>
                        
                        <img src="Evaluation%20Stack.png" style="height: 40vh">
                    
                    </td>
                    
                </tr>
            
            </table>
            
            <h2><a name="P2SH">Types of Scripts: P2SH</a></h2>
            
            <p>
                P2PKH scripts have no conditions, but some recipients/spenders would want the script to only evaluate true for certain conditions (e.g. multiple people must provide signatures to allow the output to be spent). This can be done using P2SH (Pay-To-Script-Hash) verification, where instead of hashing the public key, the recipient hashes a redeem script. This script must be fulfilled to spend the output.
            </p>
            
            <p>
                The steps for verifying a P2SH payment are the same as a P2PKH transaction, except instead of providing a public key when running the script, the recipient of the payment (Robert from the first example) must provide the redeem script (so that the two hashes match).
            </p>
            
            <p style="text-align: center"><img src="P2SH%20Transaction.png"></p>
            
            <h2><a name="Multisig">Types of Scripts: Multisig</a></h2>
            
            <p>
                Multisig is a specialised type of verification script which allows the recipient to request that multiple correct signatures must be provided to validate a transaction. This is also possible using P2SH verification (and usually P2SH would be used for this), but the specialised script type still exists.
            </p>
            
            <p>
                Multisig scripts are of the form “m-of-n”, which means that of the n provided signatures/hashes, at least m must match. m and n can be between 1 and 16. The script verification works the same way as a P2SH verification, but evaluation occurs for all “m” signatures provided, and the number verified is compared with “n”. If m is less than n, the verification fails.
            </p>
            
            <h2><a name="Pubkey">Types of Scripts: Pubkey</a></h2>
            
            <p></p>
            
        </div>
        
    </body>




</html>